---
title: "Main"
author: "willy"
date: "2024-03-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(rstan)
library(rstanarm)
library(coda)
library(mvtnorm)
library(ggplot2)
library(bayesplot)
library(loo)
source("willy.R")
source("hugo.R")
```

## Importation

```{r}
TARGET_FEATURE = "percenttp"

RawData = ImportData("Q14_survey_for_dataverse.csv")
```


```{r}
#Data <- remove_columns(RawData, c("firstthought", "recent", "tpfeel", "biggest", "paystub", "depend", "glad", "upset", "benefit", "wastethink","eitcexp", "eitcthink"))

#Data <- RemoveNA(Data)

#Data <- to_factor(Data, columns_to_exclude = c("percenttp", "wastecents", "feelfedgov_1", "weightvec"))

Data <- CleanData(RawData)

GetDatasetInformation(Data)
```


Linear 

```{r}
rstanarm_normalprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = normal(location = 0), prior_intercept = normal(location = 0))

rstanarm_productnormalprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = product_normal(df = 2, location = 0, scale = 1), prior_intercept = normal(location = 0))

rstanarm_studentprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = student_t(df = 1, location = 0), prior_intercept = normal(location = 0))

rstanarm_cauchyprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = cauchy(location = 0), prior_intercept = normal(location = 0))

rstanarm_laplaceprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = laplace(location = 0), prior_intercept = normal(location = 0))

rstanarm_hsprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = hs(df = 1, global_df = 1, global_scale = 0.01, slab_df = 4, slab_scale = 2.5), prior_intercept = normal(location = 0))

rstanarm_lassoprior_model <- BayesianLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = lasso(df = 1, location = 0), prior_intercept = normal(location = 0))

```

Non Linear

```{r}
rstanarm_normalprior_nl_model <- BayesianNonLinearRegressionRstanarm(Data, TARGET_FEATURE, prior = normal(location = 0), prior_intercept = normal(location = 0))
```



### Rstan model

Linear

```{r}
normal_rstan_model <- BayesianLinearRegressionRstan(Data, TARGET_FEATURE, "NormalStanModel.stan")

student_rstan_model <- BayesianLinearRegressionRstan(Data, TARGET_FEATURE, "StudentStanModel.stan")
```

## EVALUATION

### Rstanarm

Linear

```{r}
EvaluateBayesianRstanarmModel(rstanarm_normalprior_nl_model, Data, TARGET_FEATURE)
```

```{r}
BayesianMSERstanarm(rstanarm_productnormalprior_nl_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_studentprior_nl_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_cauchyprior_nl_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_laplaceprior_nl_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_hsprior_nl_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_lassoprior_nl_model, Data, TARGET_FEATURE)
```

Non Linear

```{r}
EvaluateBayesianRstanarmModel(rstanarm_normalprior_model, Data, TARGET_FEATURE)
```

```{r}
BayesianMSERstanarm(rstanarm_productnormalprior_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_studentprior_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_cauchyprior_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_laplaceprior_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_hsprior_model, Data, TARGET_FEATURE)
BayesianMSERstanarm(rstanarm_lassoprior_model, Data, TARGET_FEATURE)
```

### Rstan

```{r}
EvaluateBayesianRstanModel(normal_rstan_model, Data, TARGET_FEATURE)
```

```{r}
EvaluateBayesianRstanModel(student_rstan_model, Data, TARGET_FEATURE)
```

